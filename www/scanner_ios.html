<html>
<body>
<head>
<meta name="viewport" content="initial-scale=1, width=device-width, viewport-fit=cover">
<link rel="stylesheet" href="css/index.css">
<script src="js/adapter.js"></script>
<script src="js/utils.js"></script>
<script type="text/javascript" src="cordova.js"></script>
</head>
<body>

 <div>
    <video class="local-video" muted autoplay="autoplay" playsinline="playsinline" webkit-playsinline style="z-index:0;width:100%;height:100%;position:absolute;left:0;top:0;object-fit:fill;"></video>
</div>
<script>
document.addEventListener('deviceready', onDeviceReady, false);


function onDeviceReady() {
    // Cordova is now initialized. Have fun!
    alert("device ready.");
    initForPlatforms();
    TestGetUserMedia();
}

var localStream, localVideoEl, localDeviceId;
function TestGetUserMedia(deviceId) {

    if (!deviceId) {
        return navigator.mediaDevices.enumerateDevices().then(function(devices) {
            var newDevice = devices.filter(function(device) {
                return device.kind === 'videoinput';
            }).find(function(device, idx) {
                return device.deviceId !== 'default';
            });

            localDeviceId = newDevice ? newDevice.deviceId : null;
            return TestGetUserMedia(localDeviceId || 'default');
        });
    }

    console.debug('TestGetUserMedia', deviceId);
    alert(deviceId);
    return navigator.mediaDevices.getUserMedia({
        video: {
            deviceId: deviceId,
        },
        audio: false
       
    }).then(function(stream) {

        console.debug('getUserMedia.stream', stream);
        console.debug('getUserMedia.stream.getTracks', stream.getTracks());

        TestSetLocalStream(stream);

        return localStream;

    }).catch(function(err) {
        console.error('getUserMediaError', err, err.stack);
        alert(err.stack);
    });
}


function TestSetLocalStream(localStreamMedia) {
    localVideoEl = document.getElementsByClassName("local-video")[0];

    // Note: Expose for debug
    localStream = localStreamMedia;

    // Attach local stream to video element
    localVideoEl.srcObject = localStream;
}

</script>
</body>
</html>

